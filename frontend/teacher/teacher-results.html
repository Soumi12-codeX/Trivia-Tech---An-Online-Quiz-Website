<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Teacher Results - Intellect Quest</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- ‚úÖ Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:'Inter',sans-serif;
  display:flex;
  height:100vh;
  background:linear-gradient(135deg,#3a0074,#5b00b3,#7a00ff);
  color:white;
  position: relative;
}

/* Floating shapes background */
.bg-shapes { position:absolute; inset:0; z-index:0; pointer-events:none; }
.shape{position:absolute;border-radius:50%;filter:blur(18px);opacity:.22;}
.circle1{width:130px;height:130px;background:#a855f7;top:10%;left:6%;}
.circle2{width:100px;height:100px;background:#9333ea;top:72%;left:20%;}
.circle3{width:160px;height:160px;background:#c026d3;top:38%;right:8%;}
.circle4{width:90px;height:90px;background:#7c3aed;bottom:8%;right:28%;}
.icon-shape{position:absolute;font-size:38px;opacity:0.15;filter:blur(4px);color:#fff;}
.icon1{top:12%;left:52%}
.icon2{bottom:25%;left:75%;font-size:45px;}
.icon3{top:58%;left:12%;font-size:42px;}
.icon4{bottom:12%;left:42%;font-size:34px;}
.icon5{top:30%;right:15%;font-size:43px;}

/* Sidebar */
.sidebar{
  width:230px;
  background:rgba(0,0,0,0.25);
  backdrop-filter:blur(12px);
  padding:20px;
  border-right:1px solid rgba(255,255,255,0.35);
  display:flex;flex-direction:column;
  z-index:2;
}
.sidebar h2{margin-bottom:30px;font-size:22px;font-weight:700;}
.sidebar-nav a{
  display:block;padding:12px;margin-bottom:10px;
  color:white;text-decoration:none;
  background:rgba(255,255,255,0.1);
  border-radius:8px;border:1px solid rgba(255,255,255,0.25);
  transition:.2s;
}
.sidebar-nav a:hover, .sidebar-nav a.active{
  background:white;color:#6d00ff;font-weight:600;
}
.logout-btn{
  margin-top:auto;padding:12px;border-radius:8px;
  background:rgba(255,255,255,0.1);
  border:1px solid rgba(255,255,255,0.35);
  color:white;cursor:pointer;
}
.logout-btn:hover{background:white;color:#6d00ff}

/* Main content */
.main-content{
  flex:1;
  padding:35px;
  overflow-y:auto;
  position:relative;
  z-index:2;
}
.page-header h1{
  font-size:28px;
  font-weight:800;
  text-shadow:0 0 8px rgba(255,255,255,.7);
}
.page-header p{opacity:.9;margin-bottom:20px}

/* Cards */
.summary-cards{
  display:grid;
  gap:20px;
  margin-bottom:20px;
}
.card{
  background:rgba(255,255,255,0.12);
  padding:25px;border-radius:14px;
  backdrop-filter:blur(10px);
  border:1px solid rgba(255,255,255,0.5);
  text-align:center;
}
.card h3{font-size:24px;font-weight:800;margin-bottom:5px}

/* Table */
.test-list-container{
  background:rgba(255,255,255,0.13);
  border:1px solid rgba(255,255,255,0.5);
  padding:25px;border-radius:16px;
  backdrop-filter:blur(10px);
}
.test-list-table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
.test-list-table th, .test-list-table td{
  padding:15px;
  border-bottom:1px solid rgba(255,255,255,0.2);
  text-align:center;
}
.test-list-table th{
  font-size:18px;font-weight:700;
  background:rgba(255,255,255,0.15);
}
.test-list-table tr:hover{
  background:rgba(255,255,255,0.1);
  transition:.2s;
}

/* ‚úÖ Center text over donut */
.donut-text{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:20px;font-weight:800;
}
</style>
</head>

<body>

<!-- Background Shapes -->
<div class="bg-shapes">
  <div class="shape circle1"></div><div class="shape circle2"></div>
  <div class="shape circle3"></div><div class="shape circle4"></div>
  <i class="fa-solid fa-microchip icon-shape icon1"></i>
  <i class="fa-solid fa-bolt icon-shape icon2"></i>
  <i class="fa-solid fa-laptop-code icon-shape icon3"></i>
  <i class="fa-solid fa-code icon-shape icon4"></i>
  <i class="fa-solid fa-trophy icon-shape icon5"></i>
</div>

<!-- Sidebar -->
<aside class="sidebar">
  <div class="sidebar-header"><h2>Teacher Panel</h2></div>
  <nav class="sidebar-nav">
    <a href="teacher-dashboard.html"><i class="fas fa-home"></i> Dashboard</a>
    <a class="active"><i class="fas fa-chart-line"></i> View Results</a>
  </nav>
  <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
</aside>

<!-- Main Content -->
<main class="main-content">

<header class="page-header">
  <h1>Student Results</h1>
  <p>Leaderboard & Performance Stats</p>
</header>

<section class="summary-cards" style="grid-template-columns: repeat(3,1fr);">
  <div class="card"><h3 id="rank1">-</h3><p>ü•á Topper</p></div>
  <div class="card"><h3 id="rank2">-</h3><p>ü•à 2nd</p></div>
  <div class="card"><h3 id="rank3">-</h3><p>ü•â 3rd</p></div>
</section>

<!-- ‚úÖ Now 3 cards: Pass, Fail, Donut -->
<section class="summary-cards" style="grid-template-columns: repeat(3,1fr);">
  <div class="card"><h3 id="passCount">0</h3><p>‚úÖ Passed</p></div>
  <div class="card"><h3 id="failCount">0</h3><p>‚ùå Failed</p></div>

  <!-- Donut Chart -->
  <div class="card" style="position:relative;height:160px;">
    <canvas id="avgChart"></canvas>
    <div id="avgText" class="donut-text"></div>
    <p style="margin-top:5px;font-size:14px;opacity:.9;">Average Score</p>
  </div>
</section>

<section class="test-list-container">
<h2>All Submissions</h2>
<table class="test-list-table">
<thead><tr><th>Student</th><th>Score</th><th>Status</th></tr></thead>
<tbody id="results-body"></tbody>
</table>
</section>

</main>

<script>
document.addEventListener("DOMContentLoaded", loadResults);

async function loadResults() {
  const token = localStorage.getItem("mcq_portal_auth_token");
  const email = localStorage.getItem("teacher_email");

  const res = await fetch("http://localhost:8080/api/teacher/results", {
    headers:{ "Authorization":`Bearer ${token}`, "X-Email":email }
  });

  const data = await res.json();

  document.getElementById("rank1").textContent = data.top3[0] || "-";
  document.getElementById("rank2").textContent = data.top3[1] || "-";
  document.getElementById("rank3").textContent = data.top3[2] || "-";
  document.getElementById("passCount").textContent = data.pass;
  document.getElementById("failCount").textContent = data.fail;

  const body = document.getElementById("results-body");
  body.innerHTML = "";
  data.results.forEach(r=>{
    body.innerHTML += `<tr><td>${r.student}</td><td>${r.score}</td><td>${r.status}</td></tr>`;
  });

  let total = data.results.reduce((a,b)=>a + b.score, 0);
  let avg = Math.round(total / data.results.length) || 0;

  renderAvgChart(avg);
}

function renderAvgChart(avg){
  const ctx = document.getElementById("avgChart");
  new Chart(ctx,{
    type:'doughnut',
    data:{
      labels:["Average","Remaining"],
      datasets:[{
        data:[avg,100-avg],
        backgroundColor:["#00ffb7","rgba(255,255,255,0.2)"],
        borderWidth:0
      }]
    },
    options:{cutout:"70%", plugins:{legend:{display:false},tooltip:{enabled:false}}}
  });
  document.getElementById("avgText").innerHTML = avg+"%";
}

function logout(){localStorage.clear();window.location.href="teacher-login.html";}
</script>

</body>
</html>
